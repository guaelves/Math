<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å°æˆ¿å­å¡«è‰²é ï¼ˆæ‰‹æ©Ÿå‹å–„ï¼‰</title>
<style>
  :root{
    --bg:#FBFCFF; --card:#fff; --muted:#6b7280;
  }
  html,body{height:100%; margin:0; font-family:"Microsoft JhengHei",system-ui,Arial; background:var(--bg); color:#111;}
  .wrap{max-width:920px; margin:10px auto; padding:12px; display:flex; flex-direction:column; gap:12px;}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px;}
  h1{font-size:18px; margin:0;}
  .controls{display:flex; gap:8px; flex-wrap:wrap;}
  button{background:#fff; border:1px solid rgba(0,0,0,0.08); padding:8px 10px; border-radius:8px; cursor:pointer; font-size:14px;}
  #paletteCard{background:var(--card); border-radius:12px; padding:10px; box-shadow:0 6px 18px rgba(10,20,40,0.06);}
  .paletteRow{display:flex; gap:8px; justify-content:center; flex-wrap:wrap;}
  .swatch{width:46px; height:46px; border-radius:8px; border:2px solid rgba(0,0,0,0.08); box-sizing:border-box; touch-action:none;}
  .swatch.selected{outline:3px solid #111; outline-offset:2px;}
  .canvasCard{background:var(--card); border-radius:12px; padding:10px; box-shadow:0 8px 24px rgba(10,20,40,0.06); display:flex; flex-direction:column; gap:8px; align-items:center;}
  #svgContainer{width:100%; display:flex; justify-content:center;}
  svg{width:100%; max-width:700px; height:auto; touch-action:none; user-select:none;}
  .seg{cursor:pointer; stroke:#222; stroke-width:3; stroke-linejoin:round; fill:#ffffff;}
  .hint{color:var(--muted); font-size:13px;}
  @media (max-width:520px){
    .swatch{width:40px;height:40px;}
    button{padding:7px 8px;font-size:13px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ  å°æˆ¿å­å¡«è‰²é </h1>
      <div class="controls" aria-hidden="false">
        <button id="themePink">ç”œç¾ç²‰</button>
        <button id="themeOcean">æµ·æ´‹è—</button>
        <button id="themeForest">æ£®æ—ç¶ </button>
        <button id="randColors">éš¨æ©Ÿé¡è‰²</button>
        <button id="resetBtn">é‡ç½®</button>
        <button id="downloadBtn">ä¸‹è¼‰ PNG</button>
      </div>
    </header>

    <div id="paletteCard" aria-label="é¡è‰²ç›¤">
      <div class="hint">é»é¸é¡è‰² â†’ é»åœ–ä¸Šè‰²ï¼›æˆ–æ‹–æ›³é¡è‰²åˆ°åœ–ä¸Šæ”¾é–‹ï¼ˆæ‰‹æ©Ÿï¼šé•·æŒ‰é¸è‰²å†é»åœ–å€å¡Šï¼‰</div>
      <div id="palette" class="paletteRow"></div>
    </div>

    <div class="canvasCard" role="main">
      <div id="svgContainer">
        <!-- SVG å°æˆ¿å­ï¼ˆ20 å€‹å¯å¡«è‰²å€æ®µï¼Œid seg0..seg19ï¼‰ -->
        <svg id="artSvg" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" aria-label="å°æˆ¿å­è‘—è‰²é ">
          <!-- Roof -->
          <path id="seg0" class="seg" d="M80 150 L200 60 L320 150 L280 150 L200 95 L120 150 Z"/>
          <path id="seg1" class="seg" d="M120 150 L200 95 L280 150 L200 160 Z"/>
          <!-- Chimney -->
          <path id="seg2" class="seg" d="M250 75 L250 40 L275 40 L275 85 Q265 85 250 75 Z"/>
          <!-- Left wall -->
          <path id="seg3" class="seg" d="M80 150 L80 300 Q120 330 160 300 L160 170 Z"/>
          <!-- Right wall -->
          <path id="seg4" class="seg" d="M320 150 L320 300 Q280 330 240 300 L240 170 Z"/>
          <!-- Center wall -->
          <path id="seg5" class="seg" d="M160 170 L240 170 L240 300 L160 300 Z"/>
          <!-- Door -->
          <path id="seg6" class="seg" d="M185 230 L185 300 L215 300 L215 230 Q200 220 185 230 Z"/>
          <!-- Door knob -->
          <circle id="seg7" class="seg" cx="210" cy="260" r="4"/>
          <!-- Left window pane top -->
          <path id="seg8" class="seg" d="M110 180 L145 180 L145 210 L110 210 Z"/>
          <!-- Left window pane bottom -->
          <path id="seg9" class="seg" d="M110 210 L145 210 L145 240 L110 240 Z"/>
          <!-- Right window top -->
          <path id="seg10" class="seg" d="M255 180 L290 180 L290 210 L255 210 Z"/>
          <!-- Right window bottom -->
          <path id="seg11" class="seg" d="M255 210 L290 210 L290 240 L255 240 Z"/>
          <!-- Roof tile left -->
          <path id="seg12" class="seg" d="M100 130 Q140 120 180 130 Q140 125 100 130 Z"/>
          <!-- Roof tile right -->
          <path id="seg13" class="seg" d="M220 130 Q260 120 300 130 Q260 125 220 130 Z"/>
          <!-- Path front (stepping stones) -->
          <path id="seg14" class="seg" d="M160 300 Q180 320 200 315 Q220 320 240 300 L240 300 Q200 330 160 300 Z"/>
          <!-- Left bush -->
          <path id="seg15" class="seg" d="M40 290 Q70 260 100 290 Q70 280 40 290 Z"/>
          <!-- Right bush -->
          <path id="seg16" class="seg" d="M300 290 Q330 260 360 290 Q330 280 300 290 Z"/>
          <!-- Tree trunk -->
          <path id="seg17" class="seg" d="M320 200 L340 200 L340 260 L320 260 Z"/>
          <!-- Tree foliage -->
          <path id="seg18" class="seg" d="M300 170 Q335 140 370 170 Q345 160 320 170 Q315 165 300 170 Z"/>
          <!-- Sun -->
          <circle id="seg19" class="seg" cx="60" cy="60" r="28"/>
          <!-- Outline strokes for clarity -->
          <g stroke="#222" stroke-width="3" fill="none">
            <path d="M80 150 L200 60 L320 150"/>
            <path d="M80 150 L80 300 Q120 330 160 300 L160 170"/>
            <path d="M320 150 L320 300 Q280 330 240 300 L240 170"/>
            <path d="M160 170 L240 170"/>
            <path d="M160 300 L240 300"/>
          </g>
        </svg>
      </div>
      <div class="hint">æç¤ºï¼šæ‹–æ›³é¡è‰²åˆ°å€å¡Šæˆ–å…ˆé¸è‰²å†é»åœ–å€å¡Šã€‚æ‰‹æ©Ÿå¯é•·æŒ‰é¡è‰²é¸å–å¾Œé»åœ–ä¸Šè‰²ã€‚</div>
    </div>
  </div>

<script>
/* ========== è¨­å®š ========== */
const SWATCH_COUNT = 8; // é¡è‰²æ–¹å¡Šæ•¸é‡
const artSvg = document.getElementById('artSvg');
const paletteEl = document.getElementById('palette');
let selectedColor = null;

/* ä¸‰å€‹ä¸»é¡Œç¯„ä¾‹ï¼ˆæ¯å€‹æ˜¯ SWATCH_COUNT å€‹é¡è‰²ï¼‰ */
const THEMES = {
  pink: ["#FFD6E0","#FFB3C6","#FF8FAF","#FFC6E2","#FFEAF2","#FF9CC7","#FFD1E9","#FFEBF5"],
  ocean: ["#D0F0FF","#A9E6FF","#7FD1FF","#6BCBFF","#99E6FF","#66D1FF","#BFEFFF","#E9FBFF"],
  forest: ["#E6F9E6","#CBF0CB","#AEE6AE","#8FE08F","#9FE6B2","#7FCD8A","#DFF5D6","#E9FAEA"]
};

/* ç”¢ç”ŸæŸ”å’Œéš¨æ©Ÿè‰²ï¼ˆHSL åŸºç¤ï¼‰ */
function randomSoftColor(){
  const h = Math.floor(Math.random()*360);
  const s = 60 + Math.floor(Math.random()*15); // 60~75
  const l = 55 + Math.floor(Math.random()*10); // 55~65
  return `hsl(${h} ${s}% ${l}%)`;
}
function makePalette(n){
  const arr=[];
  for(let i=0;i<n;i++) arr.push(randomSoftColor());
  return arr;
}

/* ========== å»ºç«‹/æ¸²æŸ“é¡è‰²ç›¤ ========== */
function renderPalette(colors){
  paletteEl.innerHTML='';
  colors.forEach((c, idx)=>{
    const d = document.createElement('div');
    d.className='swatch';
    d.style.background = c;
    d.draggable = true;
    d.dataset.color = c;
    d.title = `é¡è‰² ${idx+1}`;
    // é»é¸ï¼ˆæ¡Œæ©Ÿ/æ‰‹æ©Ÿï¼‰
    d.addEventListener('click', ()=>{
      document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected'));
      d.classList.add('selected');
      selectedColor = c;
    });
    // touch long-press / touchstart to select quickly
    d.addEventListener('touchstart', (ev)=>{
      ev.preventDefault();
      document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected'));
      d.classList.add('selected');
      selectedColor = c;
    }, {passive:false});
    // dragstart for desktop
    d.addEventListener('dragstart', (ev)=>{
      ev.dataTransfer.setData('text/plain', c);
      try {
        const canvas = document.createElement('canvas');
        canvas.width=40; canvas.height=40;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = c; ctx.fillRect(0,0,40,40);
        ev.dataTransfer.setDragImage(canvas,20,20);
      } catch(e){}
      document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected'));
      d.classList.add('selected');
      selectedColor = c;
    });
    paletteEl.appendChild(d);
  });
  // auto select first
  const first = paletteEl.querySelector('.swatch');
  if(first){ first.classList.add('selected'); selectedColor = first.dataset.color; }
}

/* ========== SVG å€å¡Šäº‹ä»¶ï¼ˆå¡«è‰² / drag dropï¼‰ ========== */
const segEls = Array.from(artSvg.querySelectorAll('.seg'));
segEls.forEach(seg=>{
  // initialize white
  seg.style.fill = '#ffffff';
  // click / tap to fill
  seg.addEventListener('click', ()=>{
    if(selectedColor){
      seg.style.fill = selectedColor;
    } else {
      // fallback pick first
      const f = paletteEl.querySelector('.swatch');
      if(f){ f.classList.add('selected'); selectedColor = f.dataset.color; seg.style.fill = selectedColor; }
    }
  }, {passive:true});
  // dragover & drop for drag-to-fill
  seg.addEventListener('dragover', (ev)=>{ ev.preventDefault(); seg.style.filter='brightness(.95) drop-shadow(0 3px 8px rgba(0,0,0,0.12))'; });
  seg.addEventListener('dragleave', ()=>{ seg.style.filter=''; });
  seg.addEventListener('drop', (ev)=>{ ev.preventDefault(); seg.style.filter=''; const c = ev.dataTransfer.getData('text/plain'); if(c){ seg.style.fill = c; selectSwatchByColor(c); } });
  // touch: allow tap (handled by click) â€” dragging color on mobile uses selection then tap
});

/* helper: select swatch by color */
function selectSwatchByColor(c){
  const sw = Array.from(document.querySelectorAll('.swatch')).find(s=>s.dataset.color===c);
  if(sw){ document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected')); sw.classList.add('selected'); selectedColor = c; }
}

/* ========== æŒ‰éˆ•åŠŸèƒ½ ========== */
document.getElementById('randColors').addEventListener('click', ()=> {
  renderPalette(makePalette(SWATCH_COUNT));
});
document.getElementById('resetBtn').addEventListener('click', ()=> {
  segEls.forEach(s=> s.style.fill = '#ffffff');
  document.querySelectorAll('.swatch').forEach(s=> s.classList.remove('selected'));
  selectedColor = null;
});
document.getElementById('themePink').addEventListener('click', ()=> {
  renderPalette(THEMES.pink.slice(0,SWATCH_COUNT));
});
document.getElementById('themeOcean').addEventListener('click', ()=> {
  renderPalette(THEMES.ocean.slice(0,SWATCH_COUNT));
});
document.getElementById('themeForest').addEventListener('click', ()=> {
  renderPalette(THEMES.forest.slice(0,SWATCH_COUNT));
});

/* ä¸‹è¼‰ PNG */
document.getElementById('downloadBtn').addEventListener('click', ()=> {
  // clone svg and serialize
  const clone = artSvg.cloneNode(true);
  clone.querySelectorAll('.seg').forEach(el => { el.style.filter=''; el.style.transform=''; });
  const serializer = new XMLSerializer();
  const svgString = '<?xml version="1.0" standalone="no"?>\n' + serializer.serializeToString(clone);
  const blob = new Blob([svgString], {type: 'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const img = new Image();
  img.onload = function(){
    const canvas = document.createElement('canvas');
    const size = 1600; // high-res
    canvas.width = size; canvas.height = size;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
    // draw scaled to canvas
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    URL.revokeObjectURL(url);
    canvas.toBlob((b)=>{
      const a = document.createElement('a');
      a.href = URL.createObjectURL(b);
      a.download = 'house_coloring.png';
      document.body.appendChild(a);
      a.click();
      a.remove();
    }, 'image/png');
  };
  img.onerror = function(){
    alert('åŒ¯å‡ºå¤±æ•—ï¼Œè«‹æ”¹ç”¨æˆªåœ–æˆ–ç¨å€™å†è©¦ã€‚');
    URL.revokeObjectURL(url);
  };
  img.src = url;
});

/* keyboard quick select 1..8 */
window.addEventListener('keydown',(e)=>{
  if(!isNaN(Number(e.key))){
    const i = Number(e.key)-1;
    const sws = document.querySelectorAll('.swatch');
    if(i>=0 && i < sws.length){
      sws.forEach(s=>s.classList.remove('selected'));
      sws[i].classList.add('selected');
      selectedColor = sws[i].dataset.color;
    }
  }
});

/* ========== åˆå§‹åŒ–ï¼ˆé è¨­ä¸»é¡Œç‚ºæµ·æ´‹è—ï¼‰ ========== */
renderPalette(THEMES.ocean.slice(0,SWATCH_COUNT));
</script>
</body>
</html>
