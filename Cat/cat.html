<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>éš¨æ©Ÿè²“è‘—è‰²é ï¼ˆæ‰‹æ©Ÿå„ªå…ˆï¼‰</title>
<style>
  :root{
    --bg:#FAFBFF; --card:#fff; --muted:#6b7280;
  }
  html,body{height:100%; margin:0; font-family:"Microsoft JhengHei",system-ui,Segoe UI,Roboto; background:var(--bg); color:#111;}
  .wrap{max-width:900px; margin:12px auto; padding:12px; display:flex; flex-direction:column; gap:12px;}
  .topbar{display:flex; gap:8px; align-items:center; justify-content:space-between;}
  h1{font-size:18px; margin:0;}
  .controls{display:flex; gap:8px; align-items:center;}
  button{background:#fff; border:1px solid rgba(0,0,0,0.08); padding:8px 10px; border-radius:8px; cursor:pointer; font-size:14px;}
  #paletteArea{background:var(--card); border-radius:12px; padding:10px; display:flex; flex-direction:column; gap:8px; box-shadow:0 6px 18px rgba(10,20,40,0.06);}
  .paletteRow{display:flex; gap:8px; justify-content:center; flex-wrap:wrap;}
  .swatch{width:44px; height:44px; border-radius:8px; border:2px solid rgba(0,0,0,0.08); box-sizing:border-box; touch-action:none;}
  .swatch.selected{outline:3px solid #111; outline-offset:2px;}
  .canvasCard{background:var(--card); border-radius:12px; padding:10px; box-shadow:0 6px 18px rgba(10,20,40,0.06); display:flex; flex-direction:column; gap:8px; align-items:center;}
  #svgContainer{width:100%; display:flex; justify-content:center;}
  svg{width:100%; max-width:640px; height:auto; touch-action:none; user-select:none;}
  .seg{cursor:pointer; stroke:#222; stroke-width:3; fill:#ffffff;}
  .hint{color:var(--muted); font-size:13px;}
  @media (max-width:520px){
    .swatch{width:38px;height:38px;}
    button{padding:8px 8px;font-size:13px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <h1>ğŸ¾ éš¨æ©Ÿè²“è‘—è‰²é ï¼ˆæ‰‹æ©Ÿå¯ç©ï¼‰</h1>
      <div class="controls">
        <button id="randArt">é‡æ–°ç”¢ç”Ÿåœ–æ¡ˆ</button>
        <button id="randColors">éš¨æ©Ÿé¡è‰²</button>
        <button id="resetBtn">é‡ç½®</button>
        <button id="downloadBtn">ä¸‹è¼‰ PNG</button>
      </div>
    </div>

    <div id="paletteArea">
      <div class="hint">é¡è‰²åœ¨ä¸Šæ–¹ï¼šé»é¸æˆ–æ‹–æ›³é¡è‰²åˆ°ä¸‹æ–¹åœ–æ¡ˆä¸Šï¼ˆéµç›¤æ•¸å­—1~9 å¯å¿«é€Ÿé¸è‰²ï¼‰</div>
      <div id="palette" class="paletteRow" aria-label="é¡è‰²ç›¤"></div>
    </div>

    <div class="canvasCard">
      <div id="svgContainer">
        <!-- SVG å€ï¼šæˆ‘å€‘å…§å»º 3 ç¨®å¯æ„›è²“è‘—è‰²é æ¨£å¼ï¼Œéš¨æ©Ÿé¸ä¸€å€‹ -->
        <svg id="artSvg" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" aria-label="è‘—è‰²è²“åœ–"></svg>
      </div>
      <div class="hint">æ“ä½œï¼šé»é¸é¡è‰² â†’ å†é»å€å¡Šä¸Šè‰²ã€‚æˆ–é•·æŒ‰/æ‹–æ›³é¡è‰²åˆ°åœ–å¡Šæ”¾é–‹ä¾†ä¸Šè‰²ï¼ˆæ”¯æ´è§¸æ§ï¼‰</div>
    </div>
  </div>

<script>
/* ========== è¨­å®šå€ ========== */
/* å…§å»º 3 å€‹ SVG æ¨¡æ¿ï¼ˆæ¯å€‹åˆ†æˆ ~20 å€‹ <path> æˆ– <polygon>ï¼‰ï¼Œè«‹æŒ‰éœ€èª¿æ•´ç·šæ¢æˆ–åˆ†å€ */
const TEMPLATES = [

  // Template A: åœ“æ½¤å¡é€šè²“ï¼ˆfriendlyï¼‰
  `<!-- template A -->
  <g transform="translate(0,0)">
  <path id="a0" class="seg" d="M120 60 L150 20 L175 60 Q155 55 120 60 Z"/>
  <path id="a1" class="seg" d="M280 60 L310 20 L335 60 Q305 55 280 60 Z"/>
  <path id="a2" class="seg" d="M150 68 Q200 30 250 68 Q210 58 150 68 Z"/>
  <path id="a3" class="seg" d="M100 120 Q140 100 160 150 Q140 170 110 160 Q100 145 100 120 Z"/>
  <path id="a4" class="seg" d="M300 120 Q260 100 240 150 Q260 170 290 160 Q300 145 300 120 Z"/>
  <path id="a5" class="seg" d="M185 150 Q200 170 215 150 Q200 160 185 150 Z"/>
  <path id="a6" class="seg" d="M180 165 Q200 180 220 165 Q200 175 180 165 Z"/>
  <path id="a7" class="seg" d="M160 130 Q175 118 190 128 Q175 135 160 130 Z"/>
  <path id="a8" class="seg" d="M210 128 Q225 118 240 130 Q225 135 210 128 Z"/>
  <path id="a9" class="seg" d="M120 200 Q200 170 280 200 Q290 230 250 260 Q200 290 150 260 Q120 230 120 200 Z"/>
  <path id="a10" class="seg" d="M140 260 Q200 290 260 260 Q260 300 200 330 Q140 300 140 260 Z"/>
  <path id="a11" class="seg" d="M170 260 Q200 300 230 260 Q210 285 200 305 Q190 285 170 260 Z"/>
  <path id="a12" class="seg" d="M150 320 Q160 350 180 345 Q170 330 150 320 Z"/>
  <path id="a13" class="seg" d="M220 345 Q240 350 250 320 Q235 330 220 345 Z"/>
  <path id="a14" class="seg" d="M280 210 Q320 200 340 220 Q320 230 300 230 Q290 225 280 210 Z"/>
  <path id="a15" class="seg" d="M300 220 Q340 240 350 270 Q330 270 320 255 Q310 240 300 220 Z"/>
  <path id="a16" class="seg" d="M150 180 Q200 160 250 180 Q230 185 200 180 Q170 185 150 180 Z"/>
  <path id="a17" class="seg" d="M130 150 Q145 148 150 160 Q140 162 130 150 Z"/>
  <path id="a18" class="seg" d="M270 150 Q255 148 250 160 Q260 162 270 150 Z"/>
  <path id="a19" class="seg" d="M180 210 Q200 205 220 210 Q205 215 180 210 Z"/>
  </g>`,

  // Template B: åå§¿åœ“æ½¤è²“ï¼ˆæ›´åœ“çš„å€å¡Šï¼‰
  `<!-- template B -->
  <g transform="translate(0,0)">
  <path id="b0" class="seg" d="M200 40 Q170 40 150 70 Q170 60 200 60 Q230 60 250 70 Q230 40 200 40 Z"/>
  <path id="b1" class="seg" d="M150 70 Q120 100 140 130 Q160 110 150 70 Z"/>
  <path id="b2" class="seg" d="M250 70 Q280 100 260 130 Q240 110 250 70 Z"/>
  <path id="b3" class="seg" d="M140 130 Q160 150 180 140 Q160 165 140 130 Z"/>
  <path id="b4" class="seg" d="M260 130 Q240 150 220 140 Q240 165 260 130 Z"/>
  <path id="b5" class="seg" d="M180 140 Q200 160 220 140 Q200 150 180 140 Z"/>
  <path id="b6" class="seg" d="M150 170 Q200 150 250 170 Q240 200 200 210 Q160 200 150 170 Z"/>
  <path id="b7" class="seg" d="M170 210 Q200 225 230 210 Q220 235 200 245 Q180 235 170 210 Z"/>
  <path id="b8" class="seg" d="M130 220 Q160 240 180 250 Q160 260 140 250 Q130 235 130 220 Z"/>
  <path id="b9" class="seg" d="M270 220 Q240 240 220 250 Q240 260 260 250 Q270 235 270 220 Z"/>
  <path id="b10" class="seg" d="M120 260 Q170 280 200 300 Q230 280 280 260 Q260 300 200 330 Q140 300 120 260 Z"/>
  <path id="b11" class="seg" d="M180 300 Q200 320 220 300 Q200 310 180 300 Z"/>
  <path id="b12" class="seg" d="M150 320 Q170 350 190 340 Q170 330 150 320 Z"/>
  <path id="b13" class="seg" d="M210 340 Q230 350 250 320 Q235 330 210 340 Z"/>
  <path id="b14" class="seg" d="M280 200 Q320 190 350 220 Q320 230 300 230 Q285 215 280 200 Z"/>
  <path id="b15" class="seg" d="M190 80 Q200 95 210 80 Q200 90 190 80 Z"/>
  <path id="b16" class="seg" d="M160 110 Q180 105 200 110 Q180 115 160 110 Z"/>
  <path id="b17" class="seg" d="M240 110 Q220 105 200 110 Q220 115 240 110 Z"/>
  <path id="b18" class="seg" d="M200 130 Q210 145 220 130 Q210 140 200 130 Z"/>
  <path id="b19" class="seg" d="M200 170 Q205 180 210 170 Q205 175 200 170 Z"/>
  </g>`,

  // Template C: ç«™å§¿èŒè²“ï¼ˆç·šæ¢æ›´å¤šç©ºé–“åˆ†å‰²ï¼‰
  `<!-- template C -->
  <g transform="translate(0,0)">
  <path id="c0" class="seg" d="M120 60 L150 20 L170 60 Q150 55 120 60 Z"/>
  <path id="c1" class="seg" d="M280 60 L310 20 L330 60 Q300 55 280 60 Z"/>
  <path id="c2" class="seg" d="M150 72 Q200 36 250 72 Q200 60 150 72 Z"/>
  <path id="c3" class="seg" d="M100 120 Q130 100 160 140 Q140 160 110 150 Q100 135 100 120 Z"/>
  <path id="c4" class="seg" d="M300 120 Q270 100 240 140 Q260 160 290 150 Q300 135 300 120 Z"/>
  <path id="c5" class="seg" d="M170 140 Q200 170 230 140 Q210 160 190 150 Q170 140 170 140 Z"/>
  <path id="c6" class="seg" d="M180 160 Q200 185 220 160 Q200 175 180 160 Z"/>
  <path id="c7" class="seg" d="M140 180 Q175 170 190 195 Q165 200 140 180 Z"/>
  <path id="c8" class="seg" d="M260 180 Q225 170 210 195 Q235 200 260 180 Z"/>
  <path id="c9" class="seg" d="M120 200 Q200 170 280 200 Q270 230 240 250 Q200 280 160 250 Q120 230 120 200 Z"/>
  <path id="c10" class="seg" d="M150 250 Q200 280 250 250 Q250 290 200 320 Q150 290 150 250 Z"/>
  <path id="c11" class="seg" d="M170 260 Q200 295 230 260 Q210 285 200 305 Q190 285 170 260 Z"/>
  <path id="c12" class="seg" d="M140 300 Q160 330 180 320 Q160 310 140 300 Z"/>
  <path id="c13" class="seg" d="M220 330 Q240 340 260 320 Q245 330 220 330 Z"/>
  <path id="c14" class="seg" d="M280 210 Q320 200 340 220 Q320 230 300 230 Q290 225 280 210 Z"/>
  <path id="c15" class="seg" d="M300 220 Q340 240 350 270 Q330 270 320 255 Q310 240 300 220 Z"/>
  <path id="c16" class="seg" d="M150 180 Q200 160 250 180 Q230 185 200 180 Q170 185 150 180 Z"/>
  <path id="c17" class="seg" d="M130 150 Q145 148 150 160 Q140 162 130 150 Z"/>
  <path id="c18" class="seg" d="M270 150 Q255 148 250 160 Q260 162 270 150 Z"/>
  <path id="c19" class="seg" d="M180 210 Q200 205 220 210 Q205 215 180 210 Z"/>
  </g>`
];

/* åˆå§‹é¡è‰²æ•¸é‡ï¼ˆä¸Šæ–¹æ”¾ N å€‹é¡è‰²ï¼‰ */
const SWATCH_COUNT = 8;

/* ========== å·¥å…·å‡½å¼ ========== */
/* ç”¢ç”Ÿç²‰å½©/æŸ”å’Œéš¨æ©Ÿè‰²ï¼ˆHSL-basedï¼Œè¦–è¦ºè¼ƒå’Œå–„ï¼‰ */
function randomSoftColor() {
  const h = Math.floor(Math.random()*360);
  const s = 60 + Math.floor(Math.random()*20); // 60~80%
  const l = 55 + Math.floor(Math.random()*10); // 55~65%
  return `hsl(${h} ${s}% ${l}%)`;
}

/* å°‡ HSL/hex ç­‰æ ¼å¼è½‰ç‚º CSS å¯ç”¨å­—ä¸²ï¼ˆæˆ‘å€‘ä½¿ç”¨ä¸Šé¢çš„ hslï¼‰ */
function makePalette(n){
  const arr = [];
  for(let i=0;i<n;i++) arr.push(randomSoftColor());
  return arr;
}

/* å°‡ SVG æ¨£æ¿å…§æ–‡å¯«å…¥ main svg */
const artSvg = document.getElementById('artSvg');
function loadTemplate(index){
  artSvg.innerHTML = TEMPLATES[index];
  // åŠ ä¸Šè¼ªå»“ç·šï¼ˆé»‘è‰²æ¡†ï¼‰åœ¨æœ€ä¸Šæ–¹ï¼Œè®“ç·šæ¢é¡¯å¾—æ¸…æ¥š
  const outline = document.createElementNS('http://www.w3.org/2000/svg','g');
  outline.setAttribute('stroke','#222');
  outline.setAttribute('stroke-width','3');
  outline.setAttribute('fill','none');
  // ä¸€äº›å¤§è¼ªå»“ pathï¼ˆç°¡å–®åŠ å¼·ï¼‰
  const p1 = document.createElementNS('http://www.w3.org/2000/svg','path');
  p1.setAttribute('d','M120 70 L150 30 L170 72 Q200 40 230 72 L250 72 L310 30 L330 70');
  outline.appendChild(p1);
  const p2 = document.createElementNS('http://www.w3.org/2000/svg','path');
  p2.setAttribute('d','M100 120 Q140 90 150 72');
  outline.appendChild(p2);
  const p3 = document.createElementNS('http://www.w3.org/2000/svg','path');
  p3.setAttribute('d','M300 120 Q260 90 250 72');
  outline.appendChild(p3);
  artSvg.appendChild(outline);

  // å°‡æ¯å€‹ seg å¡«è‰²åˆå§‹ç‚ºç™½è‰²ï¼Œä¸¦ç¶å®šäº‹ä»¶
  const segs = Array.from(artSvg.querySelectorAll('.seg'));
  segs.forEach(s=>{
    s.style.fill = '#ffffff';
    // é»æ“Šå¡«è‰²ï¼ˆæ”¯æ´è§¸æ§ï¼‰
    s.addEventListener('click', ()=> {
      if(selectedColor) s.style.fill = selectedColor;
      else { /* fallback: é¸ç¬¬ä¸€è‰² */ selectSwatchByIndex(0); s.style.fill = selectedColor; }
    }, {passive:true});
    // æ”¯æ´æ‹–æ”¾ drop
    s.addEventListener('dragover', (ev)=>{ ev.preventDefault(); s.style.filter='brightness(.95) drop-shadow(0 3px 8px rgba(0,0,0,0.12))'; });
    s.addEventListener('dragleave', ()=>{ s.style.filter=''; });
    s.addEventListener('drop', (ev)=>{ ev.preventDefault(); const c = ev.dataTransfer.getData('text/plain'); if(c){ s.style.fill = c; selectSwatchByColor(c);} s.style.filter=''; });
    // æ”¯æ´è§¸æ§æ‹–æ”¾ï¼ˆmobileï¼‰ï¼štouchstart é–‹å§‹ã€Œæ‹–å‹• swatchã€ä¸ä¸€å®šéœ€è¦ï¼Œä½†è®“ tap ä¹Ÿæœ‰æ•ˆ
  });
  return segs;
}

/* ========== UI èˆ‡äº’å‹• ========== */
const paletteEl = document.getElementById('palette');
let currentSegs = [];
let selectedColor = null;

/* ç”Ÿæˆ / æ›´æ–°é¡è‰²ç›¤ DOM */
function renderPalette(colors){
  paletteEl.innerHTML = '';
  colors.forEach((c, i) => {
    const d = document.createElement('div');
    d.className = 'swatch';
    d.style.background = c;
    d.draggable = true;
    d.dataset.color = c;
    d.title = `é¡è‰² ${i+1}`;
    // é»é¸
    d.addEventListener('click', (e)=>{
      document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected'));
      d.classList.add('selected');
      selectedColor = c;
    });
    // dragstartï¼ˆæ‹–æ›³åˆ° svgï¼‰
    d.addEventListener('dragstart', (ev)=>{
      ev.dataTransfer.setData('text/plain', c);
      // è¨­å®šæ‹–æ›³åœ–ç‰‡ï¼ˆé¸è‰²æ–¹å¡Šæœ¬èº«ï¼‰
      try {
        const crt = document.createElement('canvas');
        crt.width = 40; crt.height = 40;
        const ctx = crt.getContext('2d');
        ctx.fillStyle = c; ctx.fillRect(0,0,40,40);
        ev.dataTransfer.setDragImage(crt,20,20);
      } catch(e){}
      // æ›´æ–°é¸è‰²ç‹€æ…‹
      document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected'));
      d.classList.add('selected');
      selectedColor = c;
    });
    // æ”¯æ´ touch: é•·æŒ‰å¾Œç›´æ¥é¸è‰²ï¼ˆä¾¿æ–¼æ‰‹æ©Ÿï¼‰
    d.addEventListener('touchstart', (ev)=>{
      ev.preventDefault();
      document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected'));
      d.classList.add('selected');
      selectedColor = c;
    }, {passive:false});
    paletteEl.appendChild(d);
  });
}

/* select by index & color helpers */
function selectSwatchByIndex(i){
  const sw = document.querySelectorAll('.swatch')[i];
  if(sw){ document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected')); sw.classList.add('selected'); selectedColor = sw.dataset.color; }
}
function selectSwatchByColor(c){
  const sw = Array.from(document.querySelectorAll('.swatch')).find(s=>s.dataset.color === c);
  if(sw){ document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected')); sw.classList.add('selected'); selectedColor = c; }
}

/* é‡æ–°ç”¢ç”Ÿé¡è‰²ï¼ˆä¸¦è‡ªå‹•å¥—ç”¨ï¼‰ */
function regenColors(n=SWATCH_COUNT){
  const pal = makePalette(n);
  renderPalette(pal);
  selectSwatchByIndex(0);
}

/* ç”¢ç”Ÿéš¨æ©Ÿåœ–æ¡ˆ */
function regenArt(){
  const idx = Math.floor(Math.random()*TEMPLATES.length);
  currentSegs = loadTemplate(idx);
}

/* Reset ï¼ˆé‚„åŸæ‰€æœ‰ seg ç‚ºç™½ï¼‰ */
function resetCanvas(){
  currentSegs.forEach(s=>s.style.fill = '#ffffff');
  document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('selected'));
  selectedColor = null;
}

/* Download PNGï¼šæŠŠ SVG è½‰æˆåœ–ï¼ˆé«˜è§£æï¼‰*/
function downloadPNG(){
  // clone node to serialize
  const clone = artSvg.cloneNode(true);
  // remove interactive attributes
  clone.querySelectorAll('.seg').forEach(el => { el.style.filter=''; el.style.transform=''; });
  const serializer = new XMLSerializer();
  const svgString = '<?xml version="1.0" standalone="no"?>\n' + serializer.serializeToString(clone);
  const blob = new Blob([svgString], {type: 'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const img = new Image();
  img.onload = function(){
    const canvas = document.createElement('canvas');
    const size = 1200;
    canvas.width = size; canvas.height = size;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
    // draw scaled
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    URL.revokeObjectURL(url);
    canvas.toBlob((b)=>{
      const a = document.createElement('a');
      a.href = URL.createObjectURL(b);
      a.download = 'cat_coloring.png';
      document.body.appendChild(a); a.click(); a.remove();
    });
  };
  img.onerror = function(){
    alert('ç”Ÿæˆåœ–ç‰‡å¤±æ•—ï¼Œå»ºè­°å…ˆæˆªåœ–ä¿å­˜ã€‚');
  };
  img.src = url;
}

/* éµç›¤å¿«é€Ÿé¸è‰²ï¼ˆæ•¸å­— 1~9 å°æ‡‰ï¼‰ */
window.addEventListener('keydown', (e)=>{
  if(!isNaN(Number(e.key))){
    const idx = Number(e.key)-1;
    if(idx>=0 && idx < document.querySelectorAll('.swatch').length){
      selectSwatchByIndex(idx);
    }
  }
});

/* åˆå§‹åŒ– */
document.getElementById('randColors').addEventListener('click', ()=> regenColors());
document.getElementById('randArt').addEventListener('click', ()=> { regenArt(); /* æ–°åœ–å¾Œæ²’æœ‰è‡ªå‹•æ”¹é¡è‰² */ });
document.getElementById('resetBtn').addEventListener('click', resetCanvas);
document.getElementById('downloadBtn').addEventListener('click', downloadPNG);

/* é¦–æ¬¡è¼‰å…¥ */
regenColors();
regenArt();

</script>
</body>
</html>
