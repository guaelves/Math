<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ä¹˜æ³•4æ³¡æ³¡éŠæˆ²</title>
<style>
  body {
    font-family: "Microsoft JhengHei", sans-serif;
    text-align: center;
    background: #fff;
  }
  h1 {
    font-size: 48px;
    margin-top: 20px;
  }
  #question {
    font-size: 70px;
    margin: 30px 0;
    font-weight: bold;
  }
  #bubbles {
    position: relative;
    width: 100%;
    height: 450px;
    margin: 20px 0;
  }
  .bubble {
    position: absolute;
    border: 2px solid #000;
    border-radius: 50%;
    background: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    font-weight: bold;
  }
  #message {
    font-size: 36px;
    color: #f44336;
    height: 50px;
    margin: 20px 0;
  }
  button {
    font-size: 28px;
    margin: 10px;
    padding: 10px 20px;
    cursor: pointer;
    border: none;
    color: #000;
    border-radius: 8px;
  }
  #startBtn {
    background-color: #ffeb3b; /* é»ƒè‰² */
  }
  #restartBtn {
    background-color: #b2fab4; /* æ·¡ç¶ è‰² */
  }
  #tableBtn {
    background-color: #b3e5fc; /* æ·¡è—è‰² */
  }
</style>
</head>
<body>

<h1>ä¹˜æ³•4æ³¡æ³¡éŠæˆ²</h1>

<div id="startContainer">
  <button id="startBtn">é–‹å§‹éŠæˆ²</button>
</div>

<div id="gameContainer" style="display:none;">
  <div id="question"></div>
  <div id="bubbles"></div>
  <div id="message"></div>
  <div>
    <button id="restartBtn">é‡æ–°é–‹å§‹</button>
    <button id="tableBtn" onclick="location.href='https://guaelves.github.io/Math/9981/'">å›åˆ°ä¹ä¹ä¹˜æ³•è¡¨ç·´ç¿’</button>
  </div>
</div>

<script>
let currentQuestion = 0;
let correctAnswers = 0;
const totalQuestions = 9;

function getRandomQuestion() {
  const n = Math.floor(Math.random() * 9) + 1;
  return { question: `4 Ã— ${n}`, answer: 4 * n };
}

function generateBubbles(correctAnswer) {
  const bubbles = [];
  const count = Math.floor(Math.random() * 2) + 5; // 5~6 å€‹æ³¡æ³¡
  const used = new Set();
  used.add(correctAnswer);
  bubbles.push(correctAnswer);

  while (bubbles.length < count) {
    let offset = Math.floor(Math.random() * 3) + 1; // Â±1~3
    let choice;
    if (correctAnswer <= 3) {
      choice = correctAnswer + offset;
    } else {
      choice = Math.random() < 0.5 ? correctAnswer + offset : correctAnswer - offset;
      if (choice < 1) choice = correctAnswer + offset;
    }
    if (!used.has(choice)) {
      bubbles.push(choice);
      used.add(choice);
    }
  }
  return bubbles.sort(() => Math.random() - 0.5);
}

function isOverlapping(x, y, size, bubbles) {
  for (let b of bubbles) {
    const dx = x - b.x;
    const dy = y - b.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < (size / 2 + b.size / 2 + 10)) return true;
  }
  return false;
}

function showQuestion() {
  const q = getRandomQuestion();
  window.currentAnswer = q.answer;
  document.getElementById("question").textContent = q.question;

  // è‡ªå‹•èªéŸ³
  if ('speechSynthesis' in window) {
    const msg = new SpeechSynthesisUtterance(q.question);
    msg.lang = "zh-TW";
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(msg);
  }

  const bubblesDiv = document.getElementById("bubbles");
  bubblesDiv.innerHTML = "";
  const messageDiv = document.getElementById("message");
  messageDiv.textContent = "";

  const bubblesData = generateBubbles(q.answer);
  const createdBubbles = [];

  bubblesData.forEach(num => {
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    const size = Math.floor(Math.random() * 60) + 80; // 80~140px
    bubble.style.width = `${size}px`;
    bubble.style.height = `${size}px`;
    bubble.style.fontSize = `${Math.floor(size / 2)}px`;

    let x, y, tries = 0;
    do {
      x = Math.random() * (bubblesDiv.clientWidth - size);
      y = Math.random() * (bubblesDiv.clientHeight - size);
      tries++;
    } while (isOverlapping(x, y, size, createdBubbles) && tries < 200);

    bubble.style.left = `${x}px`;
    bubble.style.top = `${y}px`;
    createdBubbles.push({ x, y, size });
    bubble.textContent = num;
    bubble.onclick = () => checkAnswer(num, bubble);
    bubblesDiv.appendChild(bubble);
  });
}

function checkAnswer(selected, bubble) {
  const messageDiv = document.getElementById("message");
  if (selected === window.currentAnswer) {
    messageDiv.style.color = "green";
    messageDiv.textContent = "ç­”å°ï¼";
    bubble.style.background = "#90ee90"; // æ·¡ç¶ è‰²
    correctAnswers++;
    setTimeout(() => {
      currentQuestion++;
      if (currentQuestion < totalQuestions) {
        showQuestion();
      } else {
        document.getElementById("question").textContent = "æ­å–œğŸ‰å…¨éƒ¨ç­”å°ï¼";
        document.getElementById("bubbles").innerHTML = "";
        messageDiv.textContent = "";
      }
    }, 700);
  } else {
    messageDiv.style.color = "#f44336";
    messageDiv.textContent = "ç­”éŒ¯ï¼";
    bubble.style.background = "#f44336";
    bubble.style.transform = "scale(0)";
    bubble.style.opacity = "0";
  }
}

document.getElementById("startBtn").onclick = () => {
  document.getElementById("startContainer").style.display = "none";
  document.getElementById("gameContainer").style.display = "block";
  currentQuestion = 0;
  correctAnswers = 0;
  showQuestion();
};

document.getElementById("restartBtn").onclick = () => {
  currentQuestion = 0;
  correctAnswers = 0;
  showQuestion();
};
</script>

</body>
</html>
