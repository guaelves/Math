<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>九九乘法表練習</title>
<style>
body {
  font-family: "Microsoft JhengHei", sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 20px;
}
h1 {
  font-size: clamp(28px, 6vw, 56px);
  margin-bottom: 5px;
}
p {
  font-size: clamp(14px, 3vw, 18px);
  color: #ccc;
  margin-bottom: 20px;
}
table {
  border-collapse: collapse;
}
td, th {
  width: 12vw;
  height: 12vw;
  max-width: 70px;
  max-height: 70px;
  border: 1px solid #ccc;
  text-align: center;
  vertical-align: middle;
  font-size: clamp(20px, 4vw, 48px);
  position: relative;
  cursor: pointer;
  border-radius: 10px;
  transition: background-color 0.2s, color 0.2s, font-weight 0.2s;
}
th {
  background-color: #f0f0f0;
  font-weight: bold;
}
input {
  width: 100%;
  height: 100%;
  border: none;
  text-align: center;
  font-size: clamp(20px, 4vw, 48px);
  outline: none;
  border-radius: 10px;
  background-color: #fff;
}
.correct {
  background-color: #90ee90;
}
.wrong {
  background-color: #f08080;
}
.done {
  color: #555;
}
.highlight {
  background-color: #fff9a6;
  color: #000;
  font-weight: bold;
}
.challenge-buttons {
  margin-top: 15px;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  margin-bottom: 20px;
}
.challenge-btn {
  background-color: #ff8800;
  font-size: clamp(16px, 4vw, 24px);
  padding: 10px;
  border: none;
  border-radius: 8px;
  color: #fff;
  cursor: pointer;
}
.buttons {
  margin-top: 15px;
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}
button.reset-btn {
  background-color: #007bff;
  color: #fff;
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  font-size: clamp(14px, 4vw, 20px);
  cursor: pointer;
}
button.clear-btn {
  background-color: #28a745;
  color: #fff;
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  font-size: clamp(14px, 4vw, 20px);
  cursor: pointer;
}
.message {
  margin-top: 10px;
  font-size: clamp(16px, 4vw, 28px);
  color: #007bff;
  font-weight: bold;
}
.firework {
  position: absolute;
  border-radius: 50%;
  pointer-events: none;
  animation: explode 0.8s forwards;
}
@keyframes explode {
  0% { transform: scale(0.1); opacity: 1; }
  50% { transform: scale(1.5); opacity: 1; }
  100% { transform: scale(2); opacity: 0; }
}
</style>
</head>
<body>

<h1>九九乘法表練習</h1>
<p>點選方塊可以自行輸入數字練習</p>

<div class="challenge-buttons" id="challengeButtons"></div>

<table id="multiplicationTable"></table>

<div class="buttons">
  <button class="reset-btn" id="resetBtn">重新開始</button>
  <button class="clear-btn" id="clearBtn">全部清空挑戰</button>
</div>

<div class="message" id="message"></div>

<script>
const table = document.getElementById('multiplicationTable');
const challengeButtonsDiv = document.getElementById('challengeButtons');
const messageDiv = document.getElementById('message');

// 建立挑戰按鈕 1~9
for (let n = 1; n <= 9; n++) {
  const btn = document.createElement('button');
  btn.textContent = `挑戰 ${n}`;
  btn.classList.add('challenge-btn');
  btn.addEventListener('click', () => startChallenge(n));
  challengeButtonsDiv.appendChild(btn);
}

// 播放數字語音
function speakNumber(num) {
  const utter = new SpeechSynthesisUtterance(num.toString());
  utter.lang = 'zh-TW';
  speechSynthesis.speak(utter);
}

function createTable() {
  table.innerHTML = '';
  messageDiv.textContent = '';
  currentChallenge = null;

  const headerRow = document.createElement('tr');
  const emptyCell = document.createElement('th');
  emptyCell.textContent = 'x';
  headerRow.appendChild(emptyCell);

  for (let i = 1; i <= 9; i++) {
    const th = document.createElement('th');
    th.textContent = i;
    headerRow.appendChild(th);
  }
  table.appendChild(headerRow);

  for (let i = 1; i <= 9; i++) {
    const tr = document.createElement('tr');
    const th = document.createElement('th');
    th.textContent = i;
    tr.appendChild(th);

    for (let j = 1; j <= 9; j++) {
      const td = document.createElement('td');
      td.textContent = i * j;
      td.classList.add('done');
      td.dataset.answer = i * j;
      td.dataset.row = i;
      td.dataset.col = j;

      td.addEventListener('click', function() {
        if (td.querySelector('input')) return;
        highlightHeader(i, j);
        speakNumber(j);
        setTimeout(() => speakNumber(i), 400);

        td.textContent = '';
        td.className = '';
        const input = document.createElement('input');
        input.type = 'tel';
        input.inputMode = 'numeric';
        td.appendChild(input);
        input.focus();

        input.addEventListener('blur', function() {
          const answer = parseInt(td.dataset.answer);
          const val = parseInt(input.value);
          if (val === answer) {
            td.className = 'correct';
            td.textContent = answer;
            checkChallengeCompletion();
          } else {
            td.className = 'wrong';
            td.textContent = input.value || '';
          }
          removeHighlight();
        });

        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') input.blur();
        });
      });

      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
}

function highlightHeader(row, col) {
  removeHighlight();
  const ths = table.querySelectorAll('th');
  ths[col].classList.add('highlight');
  table.rows[row].cells[0].classList.add('highlight');
}

function removeHighlight() {
  table.querySelectorAll('th').forEach(th => th.classList.remove('highlight'));
}

// 挑戰功能
let currentChallenge = null;
function startChallenge(n) {
  currentChallenge = n;
  messageDiv.textContent = '';
  for (let row = 1; row <= 9; row++) {
    const td = table.rows[row].cells[n];
    td.textContent = '';
    td.className = '';
  }
}

// 檢查挑戰完成
function checkChallengeCompletion() {
  if (!currentChallenge) return;
  let allCorrect = true;
  for (let row = 1; row <= 9; row++) {
    const td = table.rows[row].cells[currentChallenge];
    if (!td.classList.contains('correct')) {
      allCorrect = false;
      break;
    }
  }
  if (allCorrect) {
    messageDiv.textContent = `挑戰成功，恭喜全對！`;
    showFirework();
    currentChallenge = null;
  }
}

// 簡單煙火動畫
function showFirework() {
  for (let i = 0; i < 20; i++) {
    const fire = document.createElement('div');
    fire.className = 'firework';
    fire.style.width = fire.style.height = `${Math.random() * 10 + 10}px`;
    fire.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 50%)`;
    fire.style.left = `${Math.random()*90}vw`;
    fire.style.top = `${Math.random()*60}vh`;
    document.body.appendChild(fire);
    setTimeout(() => fire.remove(), 800);
  }
}

// 按鈕事件
document.getElementById('clearBtn').addEventListener('click', () => {
  const tds = table.querySelectorAll('td');
  tds.forEach(td => {
    td.textContent = '';
    td.className = '';
  });
  messageDiv.textContent = '';
});

document.getElementById('resetBtn').addEventListener('click', () => {
  createTable();
});

createTable();
</script>

<!-- 泡泡遊戲按鈕 -->
<div class="bubble-buttons" id="bubbleButtons" style="margin-top:20px; display:grid; grid-template-columns:repeat(4,1fr); gap:10px;"></div>

<script>
const bubbleButtonsDiv = document.getElementById('bubbleButtons');
for (let n = 2; n <= 9; n++) {
  const btn = document.createElement('a');
  btn.textContent = `${n} 乘法泡泡`;
  btn.href = `https://guaelves.github.io/Math/9981/${n}.html`;
  // btn.target = "_blank";
  btn.style.display = 'inline-block';
  btn.style.backgroundColor = '#c8a2f7';
  btn.style.color = '#fff';
  btn.style.textAlign = 'center';
  btn.style.fontSize = 'clamp(16px, 4vw, 24px)';
  btn.style.padding = '10px';
  btn.style.borderRadius = '8px';
  btn.style.textDecoration = 'none';
  btn.style.cursor = 'pointer';
  bubbleButtonsDiv.appendChild(btn);
}

// 最後的 2~9 乘法泡泡
const allBtn = document.createElement('a');
allBtn.textContent = '2~9 乘法泡泡';
allBtn.href = 'https://guaelves.github.io/Math/9981/All.html';
// allBtn.target = "_blank";
allBtn.style.display = 'inline-block';
allBtn.style.backgroundColor = '#ff6f61';
allBtn.style.color = '#fff';
allBtn.style.textAlign = 'center';
allBtn.style.fontSize = 'clamp(16px, 4vw, 24px)';
allBtn.style.padding = '10px';
allBtn.style.borderRadius = '8px';
allBtn.style.textDecoration = 'none';
allBtn.style.cursor = 'pointer';
bubbleButtonsDiv.appendChild(allBtn);
</script>

</body>
</html>
