<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>乘法2泡泡遊戲</title>
<style>
  body {
    font-family: "Microsoft JhengHei", sans-serif;
    text-align: center;
    background: #e0f7fa;
  }
  h1 {
    font-size: 48px;
    margin-top: 20px;
  }
  #question {
    font-size: 40px;
    margin: 30px 0;
  }
  .bubble {
    display: inline-block;
    margin: 15px;
    padding: 20px 30px;
    border-radius: 50%;
    background: #80deea;
    font-size: 32px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }
  .bubble.correct {
    animation: pop 0.5s ease forwards;
    background: #ffcc80;
  }
  @keyframes pop {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 1; }
    100% { transform: scale(0); opacity: 0; }
  }
  #message {
    font-size: 36px;
    color: #f44336;
    margin: 20px 0;
    height: 50px;
  }
  button {
    font-size: 28px;
    margin: 10px;
    padding: 10px 20px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>乘法2泡泡遊戲</h1>
<div id="question"></div>
<div id="bubbles"></div>
<div id="message"></div>
<button id="retryBtn" style="display:none;">重新挑戰</button>
<button id="tableBtn" onclick="location.href='#'">回到九九乘法表練習</button>

<script>
let currentQuestion = 0;
let correctAnswers = 0;
const totalQuestions = 9;

function getRandomQuestion() {
  const n = Math.floor(Math.random() * 9) + 1;
  return {question: `2 × ${n}`, answer: 2 * n};
}

function generateBubbles(correctAnswer) {
  const bubbles = [];
  const count = Math.floor(Math.random() * 2) + 5; // 5~6 個泡泡
  const used = new Set();
  used.add(correctAnswer);

  bubbles.push(correctAnswer);
  while (bubbles.length < count) {
    let offset = Math.floor(Math.random() * 3) + 1; // ±1~3
    let choice = Math.random() < 0.5 ? correctAnswer + offset : correctAnswer - offset;
    if (choice > 0 && !used.has(choice)) {
      bubbles.push(choice);
      used.add(choice);
    }
  }

  // 隨機打亂順序
  bubbles.sort(() => Math.random() - 0.5);
  return bubbles;
}

function showQuestion() {
  const q = getRandomQuestion();
  window.currentAnswer = q.answer;
  document.getElementById("question").textContent = q.question;
  const bubblesDiv = document.getElementById("bubbles");
  bubblesDiv.innerHTML = "";

  const bubbles = generateBubbles(q.answer);
  bubbles.forEach(num => {
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.style.fontSize = `${30 + Math.random()*10}px`;
    bubble.style.width = `${60 + Math.random()*20}px`;
    bubble.style.height = `${60 + Math.random()*20}px`;
    bubble.textContent = num;
    bubble.onclick = () => checkAnswer(num, bubble);
    bubblesDiv.appendChild(bubble);
  });
  document.getElementById("message").textContent = "";
}

function checkAnswer(selected, bubble) {
  if (selected === window.currentAnswer) {
    bubble.classList.add("correct");
    document.getElementById("message").textContent = "答對了！";
    correctAnswers++;
    setTimeout(() => {
      currentQuestion++;
      if (currentQuestion < totalQuestions) {
        showQuestion();
      } else {
        document.getElementById("question").textContent = "恭喜全部答對！";
        document.getElementById("bubbles").innerHTML = "";
        document.getElementById("retryBtn").style.display = "inline-block";
      }
    }, 700);
  } else {
    bubble.style.background = "#e57373";
    bubble.style.transform = "scale(0.8)";
  }
}

document.getElementById("retryBtn").onclick = () => {
  currentQuestion = 0;
  correctAnswers = 0;
  document.getElementById("retryBtn").style.display = "none";
  showQuestion();
}

// 初始化
showQuestion();
</script>

</body>
</html>
