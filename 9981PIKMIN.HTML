<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>çš®å…‹æ•ä¹˜æ³•å†’éšª</title>
    <style>
        :root {
            --red: #ff5252; --yellow: #ffd740; --blue: #448aff;
            --purple: #9c27b0; --white: #ffffff; --rock: #607d8b;
            --wing: #f48fb1; --ice: #b3e5fc; --ghost: #ccff00;
        }
        body { font-family: "Arial", "Microsoft JhengHei", sans-serif; background-color: #f1f8e9; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #game-box { background: white; padding: 25px; border-radius: 40px; box-shadow: 0 15px 0 #aed581; text-align: center; width: 480px; position: relative; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 0 10px; }
        select { padding: 5px; border-radius: 10px; border: 2px solid #8bc34a; font-size: 16px; cursor: pointer; }
        .progress-container { width: 100%; height: 12px; background: #eee; border-radius: 6px; margin-bottom: 15px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: #4caf50; transition: 0.4s; }

        .stage { height: 160px; background: #fffde7; border-radius: 30px; border: 4px solid #fff176; margin-bottom: 25px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .monster { font-size: 65px; margin-bottom: 5px; transition: 0.4s; }
        .math { font-size: 68px; font-weight: bold; color: #33691e; }

        .choice-row { display: flex; justify-content: space-around; gap: 12px; }
        .pikmin-btn {
            background: #fff; border: 3px solid #eee; border-radius: 25px; padding: 15px 10px; cursor: pointer;
            flex: 1; transition: 0.2s; display: flex; flex-direction: column; align-items: center;
        }
        .pikmin-btn:hover { transform: translateY(-8px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: #8bc34a; }

        /* --- çš®å…‹æ•ç¹ªåœ–æ ¸å¿ƒ --- */
        .pikmin-art { width: 70px; height: 85px; position: relative; margin-bottom: 8px; }
        .p-stem { width: 3px; height: 25px; background: #5d4037; position: absolute; top: 0; left: 34px; z-index: 1; }
        .p-body { width: 42px; height: 48px; border-radius: 45% 45% 42% 42%; border: 2.5px solid #333; position: absolute; bottom: 0; left: 14px; z-index: 2; }
        
        /* çœ¼ç›æ¨£å¼ */
        .p-eye-socket { width: 15px; height: 17px; background: white; border-radius: 50%; border: 1.8px solid #333; position: absolute; top: 12px; }
        .p-pupil { width: 7px; height: 8px; background: black; border-radius: 50%; position: absolute; top: 4.5px; left: 4px; }
        .eye-l { left: -3px; }
        .eye-r { right: -3px; }

        /* ä¸‰ç¨®é ­éƒ¨ç‹€æ…‹ */
        .p-leaf { width: 24px; height: 14px; background: #4caf50; border-radius: 50% 0; border: 1.5px solid #2e7d32; position: absolute; top: -10px; left: 34px; transform: rotate(-20deg); z-index: 3; }
        .p-bud { width: 14px; height: 18px; background: #fffde7; border-radius: 50% 50% 20% 20%; border: 2px solid #81c784; position: absolute; top: -12px; left: 28px; z-index: 3; }
        .p-bud::after { content:''; width: 14px; height: 6px; background: #81c784; position: absolute; bottom: 0; border-radius: 0 0 10px 10px; }
        .p-flower { position: absolute; top: -24px; left: 22px; font-size: 28px; z-index: 3; }

        .num { font-size: 34px; font-weight: bold; color: #444; }
        #msg { margin-top: 15px; font-size: 20px; font-weight: bold; min-height: 30px; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); border-radius: 40px; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
    </style>
</head>
<body>

<div id="game-box">
    <div class="overlay" id="finish-screen">
        <h1 style="color: #4caf50; font-size: 45px;">ğŸŒŸ æŒ‘æˆ°æˆåŠŸï¼</h1>
        <p style="font-size: 24px;">ä½ å°çš®å…‹æ•çš„äº†è§£çœŸæ˜¯å¤§å¸«ç´šï¼</p>
        <button onclick="restartGame()" style="padding: 15px 40px; font-size: 24px; cursor: pointer; background: #4caf50; color: white; border: none; border-radius: 20px; margin-top: 20px; box-shadow: 0 5px 0 #2e7d32;">å†ä¾†ä¸€è¼ªï¼</button>
    </div>

    <div class="header">
        <span style="font-weight:bold; color: #666;">é€²åº¦: <span id="q-num">1</span>/10</span>
        <select id="base-num" onchange="restartGame()">
            <option value="2">2 çš„ä¹˜æ³•è¡¨</option><option value="3">3 çš„ä¹˜æ³•è¡¨</option>
            <option value="4">4 çš„ä¹˜æ³•è¡¨</option><option value="5">5 çš„ä¹˜æ³•è¡¨</option>
            <option value="6">6 çš„ä¹˜æ³•è¡¨</option><option value="7">7 çš„ä¹˜æ³•è¡¨</option>
            <option value="8">8 çš„ä¹˜æ³•è¡¨</option><option value="9">9 çš„ä¹˜æ³•è¡¨</option>
        </select>
    </div>

    <div class="progress-container"><div id="progress-bar"></div></div>
    
    <div class="stage">
        <div id="m-icon" class="monster">ğŸ‘¾</div>
        <div class="math" id="quest">? x ?</div>
    </div>

    <div class="choice-row" id="choices"></div>
    <div id="msg">ç™¼ç¾ç›®æ¨™ï¼æ´¾å‡ºçš®å…‹æ•ï¼</div>
</div>

<script>
    const monsters = ['ğŸ','ğŸ•·ï¸','ğŸ¦€','ğŸŒ','ğŸ','ğŸ¦‹','ğŸ„','ğŸ‘¾','ğŸ¦','ğŸ¸','ğŸ¦–','ğŸ™','ğŸ¦','ğŸ¦“','ğŸ‘½'];
    const pikminConfig = [
        { key: '--red', eye: 'white', pupil: 'black' },
        { key: '--yellow', eye: 'white', pupil: 'black' },
        { key: '--blue', eye: 'white', pupil: 'black' },
        { key: '--purple', eye: 'white', pupil: 'black' },
        { key: '--white', eye: '#ff5252', pupil: 'transparent' }, 
        { key: '--rock', eye: 'white', pupil: 'black' },
        { key: '--wing', eye: '#e1f5fe', pupil: 'transparent' },  
        { key: '--ice', eye: 'white', pupil: 'black' },
        { key: '--ghost', isGhost: true }
    ];
    
    let currentBase = 2;
    let questionPool = [];
    let configPool = [];
    let solvedCount = 0;
    let targetVal = 0;

    function restartGame() {
        currentBase = parseInt(document.getElementById('base-num').value);
        solvedCount = 0;
        questionPool = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
        questionPool.push(Math.floor(Math.random()*9)+1);
        configPool = [...pikminConfig].sort(() => Math.random() - 0.5);
        document.getElementById('finish-screen').style.display = 'none';
        updateUI();
        nextQuestion();
    }

    function updateUI() {
        document.getElementById('progress-bar').style.width = (solvedCount * 10) + '%';
        document.getElementById('q-num').innerText = Math.min(solvedCount + 1, 10);
    }

    function getHeadHtml() {
        const rand = Math.random();
        if (rand < 0.33) return '<div class="p-leaf"></div>';
        if (rand < 0.66) return '<div class="p-bud"></div>';
        return '<div class="p-flower">ğŸŒ¸</div>';
    }

    function getPikminBody(config) {
        let eyeHtml = '';
        if (config.isGhost) {
            // å¹½éˆçš®ï¼šå·¦çœ¼å¤§è—æ¡†ç™½åº•ç„¡ç ï¼Œå³çœ¼å°è—çœ¼æœ‰ç 
            eyeHtml = `
                <div class="p-eye-socket eye-l" style="background:white; border:2px solid #00bcd4;">
                    <div class="p-pupil" style="display:none;"></div>
                </div>
                <div class="p-eye-socket eye-r" style="background:#00bcd4; width:10px; height:12px; border:none; top:15px; right:0px;">
                    <div class="p-pupil" style="background:white; width:3px; height:4px; top:4px; left:3.5px;"></div>
                </div>
            `;
        } else {
            eyeHtml = `
                <div class="p-eye-socket eye-l" style="background:${config.eye}; border-color:${config.pupil === 'transparent' ? 'transparent' : '#333'}">
                    <div class="p-pupil" style="background:${config.pupil};"></div>
                </div>
                <div class="p-eye-socket eye-r" style="background:${config.eye}; border-color:${config.pupil === 'transparent' ? 'transparent' : '#333'}">
                    <div class="p-pupil" style="background:${config.pupil};"></div>
                </div>
            `;
        }
        return `<div class="p-body" style="background:var(${config.key})">${eyeHtml}</div>`;
    }

    function nextQuestion() {
        if (solvedCount >= 10) {
            document.getElementById('finish-screen').style.display = 'flex';
            return;
        }

        const n = questionPool[solvedCount];
        targetVal = currentBase * n;
        document.getElementById('quest').innerText = `${currentBase} x ${n}`;
        document.getElementById('m-icon').innerText = monsters[Math.floor(Math.random() * monsters.length)];
        document.getElementById('m-icon').style.transform = "scale(1) rotate(0deg)";

        let displayConfigs = [];
        for(let i=0; i<3; i++) {
            if(configPool.length === 0) configPool = [...pikminConfig].sort(() => Math.random() - 0.5);
            displayConfigs.push(configPool.pop());
        }

        let opts = [targetVal];
        while(opts.length < 3) {
            let f = currentBase * (Math.floor(Math.random() * 9) + 1);
            if(!opts.includes(f)) opts.push(f);
        }
        opts.sort(() => Math.random() - 0.5);

        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = '';

        opts.forEach((v, i) => {
            const btn = document.createElement('div');
            btn.className = 'pikmin-btn';
            
            btn.innerHTML = `
                <div class="pikmin-art">
                    <div class="p-stem"></div>
                    ${getHeadHtml()}
                    ${getPikminBody(displayConfigs[i])}
                </div>
                <div class="num">${v}</div>
            `;
            btn.onclick = () => {
                if(v === targetVal) {
                    solvedCount++;
                    updateUI();
                    document.getElementById('msg').innerText = "âœ¨ å˜¿å’»ï¼æ“Šå€’æ€ªç‰©äº†ï¼";
                    document.getElementById('msg').style.color = "#43a047";
                    document.getElementById('m-icon').style.transform = "scale(0) rotate(180deg)";
                    setTimeout(nextQuestion, 800);
                } else {
                    document.getElementById('msg').innerText = "âŒ æ•¸é‡ä¸å°ï¼Œå†ç®—ä¸€ä¸‹ï¼";
                    document.getElementById('msg').style.color = "#d32f2f";
                }
            };
            choicesDiv.appendChild(btn);
        });
    }
    restartGame();
</script>
</body>
</html>