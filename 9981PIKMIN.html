<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çš®å…‹æ•ä¹˜æ³•å†’éšª</title>
    <style>
        :root {
            --red: #ff5252; --yellow: #ffd740; --blue: #448aff;
            --purple: #9c27b0; --white: #ffffff; --rock: #607d8b;
            --wing: #f48fb1; --ice: #b3e5fc; --ghost: #ccff00;
        }
        body { 
            font-family: "Arial", "Microsoft JhengHei", sans-serif; 
            background-color: #f1f8e9; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹• */
        }

        #game-box { 
            background: white; 
            padding: 15px; 
            border-radius: 30px; 
            box-shadow: 0 10px 0 #aed581; 
            text-align: center; 
            width: 98vw;      /* è¢å¹•å¯¬åº¦çš„ 98% */
            height: 70vh;     /* è¢å¹•é«˜åº¦çš„ 70% */
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            position: relative;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; height: 40px; }
        select { padding: 5px; border-radius: 10px; border: 2px solid #8bc34a; font-size: 16px; cursor: pointer; }
        
        .progress-container { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin-bottom: 10px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: #4caf50; transition: 0.4s; }

        /* é¡Œç›®å€ï¼šè¨­å®šç‚º 2 å€æ¬Šé‡ */
        .stage { 
            flex: 2; 
            background: #fffde7; 
            border-radius: 20px; 
            border: 4px solid #fff176; 
            margin-bottom: 15px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        .monster { font-size: clamp(40px, 10vh, 80px); margin-bottom: 5px; transition: 0.4s; }
        .math { font-size: clamp(50px, 12vh, 100px); font-weight: bold; color: #33691e; }

        /* ç­”æ¡ˆå€ï¼šè¨­å®šç‚º 1 å€æ¬Šé‡ (é¡Œç›®çš„ä¸€åŠ) */
        .choice-row { 
            flex: 1; 
            display: flex; 
            justify-content: space-around; 
            gap: 10px; 
        }
        
        .pikmin-btn {
            background: #fff; border: 3px solid #eee; border-radius: 20px; 
            cursor: pointer; flex: 1; transition: 0.2s; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .pikmin-btn:hover { transform: translateY(-5px); border-color: #8bc34a; }

        /* çš®å…‹æ•ç¹ªåœ–ç¸®æ”¾é©æ‡‰é«˜åº¦ */
        .pikmin-art { width: 60px; height: 75px; position: relative; transform: scale(0.9); }
        .p-stem { width: 3px; height: 20px; background: #5d4037; position: absolute; top: 0; left: 28px; z-index: 1; }
        .p-body { width: 36px; height: 42px; border-radius: 45%; border: 2px solid #333; position: absolute; bottom: 0; left: 12px; z-index: 2; }
        .p-eye-socket { width: 12px; height: 14px; background: white; border-radius: 50%; border: 1.5px solid #333; position: absolute; top: 10px; }
        .p-pupil { width: 6px; height: 7px; background: black; border-radius: 50%; position: absolute; top: 3.5px; left: 3px; }
        .eye-l { left: -2px; }
        .eye-r { right: -2px; }
        .p-leaf { width: 20px; height: 12px; background: #4caf50; border-radius: 50% 0; border: 1.2px solid #2e7d32; position: absolute; top: -8px; left: 28px; transform: rotate(-20deg); z-index: 3; }
        .p-flower { position: absolute; top: -20px; left: 18px; font-size: 24px; z-index: 3; }

        .num { font-size: clamp(24px, 5vh, 40px); font-weight: bold; color: #444; }
        #msg { height: 30px; margin-top: 10px; font-size: 18px; font-weight: bold; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); border-radius: 30px; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
    </style>
</head>
<body>

<div id="game-box">
    <div class="overlay" id="finish-screen">
        <h1 style="color: #4caf50; font-size: 36px;">ğŸŒŸ æŒ‘æˆ°æˆåŠŸï¼</h1>
        <button onclick="restartGame()" style="padding: 12px 30px; font-size: 20px; cursor: pointer; background: #4caf50; color: white; border: none; border-radius: 15px; box-shadow: 0 5px 0 #2e7d32;">å†ä¾†ä¸€è¼ªï¼</button>
    </div>

    <div class="header">
        <span style="font-weight:bold; color: #666;">é€²åº¦: <span id="q-num">1</span>/10</span>
        <select id="base-num" onchange="restartGame()">
            <option value="2">2 çš„ä¹˜æ³•è¡¨</option><option value="3">3 çš„ä¹˜æ³•è¡¨</option>
            <option value="4">4 çš„ä¹˜æ³•è¡¨</option><option value="5">5 çš„ä¹˜æ³•è¡¨</option>
            <option value="6">6 çš„ä¹˜æ³•è¡¨</option><option value="7">7 çš„ä¹˜æ³•è¡¨</option>
            <option value="8">8 çš„ä¹˜æ³•è¡¨</option><option value="9">9 çš„ä¹˜æ³•è¡¨</option>
        </select>
    </div>

    <div class="progress-container"><div id="progress-bar"></div></div>
    
    <div class="stage">
        <div id="m-icon" class="monster">ğŸ‘¾</div>
        <div class="math" id="quest">? x ?</div>
    </div>

    <div class="choice-row" id="choices"></div>
    <div id="msg">ç™¼ç¾ç›®æ¨™ï¼æ´¾å‡ºçš®å…‹æ•ï¼</div>
</div>

<script>
    const monsters = ['ğŸ','ğŸ•·ï¸','ğŸ¦€','ğŸŒ','ğŸ','ğŸ¦‹','ğŸ„','ğŸ‘¾','ğŸ¦','ğŸ¸','ğŸ¦–','ğŸ™','ğŸ¦','ğŸ¦“','ğŸ‘½'];
    const pikminConfig = [
        { key: '--red', eye: 'white', pupil: 'black' },
        { key: '--yellow', eye: 'white', pupil: 'black' },
        { key: '--blue', eye: 'white', pupil: 'black' },
        { key: '--purple', eye: 'white', pupil: 'black' },
        { key: '--white', eye: '#ff5252', pupil: 'transparent' }, 
        { key: '--rock', eye: 'white', pupil: 'black' },
        { key: '--wing', eye: '#e1f5fe', pupil: 'transparent' },  
        { key: '--ice', eye: 'white', pupil: 'black' },
        { key: '--ghost', isGhost: true }
    ];
    
    let currentBase = 2;
    let questionPool = [];
    let configPool = [];
    let solvedCount = 0;
    let targetVal = 0;

    function restartGame() {
        currentBase = parseInt(document.getElementById('base-num').value);
        solvedCount = 0;
        questionPool = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
        questionPool.push(Math.floor(Math.random()*9)+1);
        configPool = [...pikminConfig].sort(() => Math.random() - 0.5);
        document.getElementById('finish-screen').style.display = 'none';
        updateUI();
        nextQuestion();
    }

    function updateUI() {
        document.getElementById('progress-bar').style.width = (solvedCount * 10) + '%';
        document.getElementById('q-num').innerText = Math.min(solvedCount + 1, 10);
    }

    function getHeadHtml() {
        const rand = Math.random();
        if (rand < 0.33) return '<div class="p-leaf"></div>';
        return '<div class="p-flower">ğŸŒ¸</div>';
    }

    function getPikminBody(config) {
        let eyeHtml = `
            <div class="p-eye-socket eye-l" style="background:${config.isGhost?'white':config.eye};">
                <div class="p-pupil" style="background:${config.isGhost?'transparent':config.pupil};"></div>
            </div>
            <div class="p-eye-socket eye-r" style="background:${config.isGhost?'white':config.eye};">
                <div class="p-pupil" style="background:${config.isGhost?'transparent':config.pupil};"></div>
            </div>`;
        return `<div class="p-body" style="background:var(${config.key})">${eyeHtml}</div>`;
    }

    function nextQuestion() {
        if (solvedCount >= 10) {
            document.getElementById('finish-screen').style.display = 'flex';
            return;
        }

        const n = questionPool[solvedCount];
        targetVal = currentBase * n;
        document.getElementById('quest').innerText = `${currentBase} x ${n}`;
        document.getElementById('m-icon').innerText = monsters[Math.floor(Math.random() * monsters.length)];
        document.getElementById('m-icon').style.transform = "scale(1)";

        let displayConfigs = [];
        for(let i=0; i<3; i++) {
            if(configPool.length === 0) configPool = [...pikminConfig].sort(() => Math.random() - 0.5);
            displayConfigs.push(configPool.pop());
        }

        let opts = [targetVal];
        while(opts.length < 3) {
            let f = currentBase * (Math.floor(Math.random() * 9) + 1);
            if(!opts.includes(f)) opts.push(f);
        }
        opts.sort(() => Math.random() - 0.5);

        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = '';

        opts.forEach((v, i) => {
            const btn = document.createElement('div');
            btn.className = 'pikmin-btn';
            btn.innerHTML = `
                <div class="pikmin-art">
                    <div class="p-stem"></div>
                    ${getHeadHtml()}
                    ${getPikminBody(displayConfigs[i])}
                </div>
                <div class="num">${v}</div>
            `;
            btn.onclick = () => {
                if(v === targetVal) {
                    solvedCount++;
                    updateUI();
                    document.getElementById('msg').innerText = "âœ¨ æ“Šå€’æ€ªç‰©äº†ï¼";
                    document.getElementById('m-icon').style.transform = "scale(0)";
                    setTimeout(nextQuestion, 600);
                } else {
                    document.getElementById('msg').innerText = "âŒ å†ç®—ä¸€ä¸‹ï¼";
                }
            };
            choicesDiv.appendChild(btn);
        });
    }
    restartGame();
</script>
</body>

</html>
